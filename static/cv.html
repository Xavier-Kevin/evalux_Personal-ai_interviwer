<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CV Analysis ‚Äî EVALUX</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: #e2e8f0;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: rgba(26, 34, 53, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 217, 255, 0.2);
      padding: 20px 40px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #36f3e2, #3a8fff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    nav a {
      text-decoration: none;
    }

    .btn-secondary {
      padding: 10px 24px;
      background: transparent;
      color: #36f3e2;
      border: 2px solid #36f3e2;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: #36f3e2;
      color: #0a0e27;
      transform: translateY(-2px);
    }

    /* Main Content */
    main {
      padding: 40px 20px;
    }

    .cv-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .cv-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .cv-header h2 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #36f3e2 0%, #3a8fff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .muted {
      color: #8892b0;
      font-size: 1.1rem;
    }

    /* Upload Area */
    .upload-area {
      background: rgba(26, 34, 53, 0.6);
      border: 2px dashed rgba(0, 217, 255, 0.3);
      border-radius: 16px;
      padding: 60px 40px;
      text-align: center;
      transition: all 0.3s;
      margin-bottom: 30px;
    }

    .upload-area:hover {
      border-color: rgba(0, 217, 255, 0.6);
      background: rgba(26, 34, 53, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 217, 255, 0.15);
    }

    .upload-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      display: block;
      color: #36f3e2;
    }

    .btn-primary {
      padding: 12px 32px;
      background: linear-gradient(90deg, #36f3e2 0%, #3a8fff 100%);
      color: #0a0e27;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin: 20px 0;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(54, 243, 226, 0.4);
    }

    /* Preview Section */
    .preview-section {
      display: none;
      background: rgba(26, 34, 53, 0.6);
      border: 1px solid rgba(0, 217, 255, 0.2);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      animation: fadeIn 0.3s ease-out;
    }

    .preview-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .preview-header h3 {
      color: #36f3e2;
      font-size: 1.5rem;
      margin-bottom: 20px;
    }

    .file-info {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .file-info-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .file-info-row:last-child {
      border-bottom: none;
    }

    .file-info-label {
      color: #8892b0;
      font-weight: 600;
    }

    .file-info-value {
      color: #36f3e2;
      font-weight: 600;
    }

    .button-group {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
    }

    .btn-cancel {
      padding: 12px 24px;
      background: transparent;
      color: #ff6b6b;
      border: 2px solid #ff6b6b;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-cancel:hover {
      background: #ff6b6b;
      color: #fff;
    }

    .btn-confirm {
      padding: 12px 24px;
      background: linear-gradient(90deg, #00ff88 0%, #00cc6a 100%);
      color: #0a0e27;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 255, 136, 0.4);
    }

    .btn-confirm:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Status Message */
    .status-msg {
      padding: 15px 20px;
      border-radius: 8px;
      margin: 20px 0;
      font-weight: 600;
      text-align: center;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .status-msg.success {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      color: #00ff88;
    }

    .status-msg.error {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.3);
      color: #ff6b6b;
    }

    .status-msg.info {
      background: rgba(54, 243, 226, 0.1);
      border: 1px solid rgba(54, 243, 226, 0.3);
      color: #36f3e2;
    }

    /* Analysis Result */
    .analysis-result {
      display: none;
      background: rgba(26, 34, 53, 0.6);
      border: 1px solid rgba(0, 217, 255, 0.2);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      animation: fadeIn 0.3s ease-out;
    }

    .analysis-result.active {
      display: block;
    }

    .analysis-result h3 {
      color: #00ff88;
      font-size: 1.5rem;
      margin-bottom: 20px;
    }

    .analysis-content ul {
      list-style: none;
      padding: 0;
    }

    .analysis-content li {
      padding: 12px 15px;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border-left: 3px solid #36f3e2;
      color: #ccd6f6;
      line-height: 1.6;
    }

    .analysis-content strong {
      color: #36f3e2;
    }

    /* Navigation Options */
    .nav-options {
      display: none;
      text-align: center;
      margin-top: 40px;
      animation: fadeIn 0.5s ease-out;
    }

    .nav-options.active {
      display: block;
    }

    .nav-options h3 {
      color: #36f3e2;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .nav-options p {
      color: #8892b0;
      font-size: 1.1rem;
      margin-bottom: 30px;
    }

    .nav-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .nav-card {
      background: rgba(26, 34, 53, 0.6);
      border: 1px solid rgba(0, 217, 255, 0.2);
      border-radius: 16px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .nav-card:hover {
      transform: translateY(-5px);
      border-color: rgba(0, 217, 255, 0.5);
      box-shadow: 0 10px 30px rgba(0, 217, 255, 0.2);
      background: rgba(26, 34, 53, 0.8);
    }

    .nav-card-icon {
      font-size: 3rem;
      display: block;
      margin-bottom: 15px;
    }

    .nav-card h4 {
      color: #36f3e2;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .nav-card p {
      color: #8892b0;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    /* Footer */
    .footer {
      background: rgba(26, 34, 53, 0.8);
      border-top: 1px solid rgba(0, 217, 255, 0.2);
      padding: 40px 20px;
      margin-top: 60px;
    }

    .footer .container {
      text-align: center;
    }

    .footer-logo {
      font-weight: 700;
      color: #36f3e2;
      font-size: 1.5rem;
      display: block;
      margin-bottom: 10px;
    }

    .footer p {
      color: #8892b0;
      font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 15px 20px;
      }

      .cv-header h2 {
        font-size: 2rem;
      }

      .upload-area {
        padding: 40px 20px;
      }

      .button-group {
        flex-direction: column;
      }

      .nav-cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="nav-brand">EVALUX</div>
      <nav>
        <a href="dashboard.html" class="btn-secondary">Dashboard</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="cv-container">
      <div class="cv-header">
        <h2>CV / Resume Analysis</h2>
        <p class="muted">Upload your CV to get personalized interview questions</p>
      </div>

      <!-- Upload Area -->
      <div id="uploadArea" class="upload-area">
        <span class="upload-icon">üìÑ</span>
        <input type="file" id="cvFile" style="display:none;" accept=".pdf,.doc,.docx" />
        <button id="browseBtn" class="btn-primary" type="button">Browse File</button>
        <p class="muted">Supported formats: PDF, DOC, DOCX (Max 10MB)</p>
      </div>

      <!-- Preview Section -->
      <div id="previewSection" class="preview-section">
        <div class="preview-header">
          <h3>Review Your Upload</h3>
        </div>
        
        <div class="file-info">
          <div class="file-info-row">
            <span class="file-info-label">File Name:</span>
            <span class="file-info-value" id="fileName">-</span>
          </div>
          <div class="file-info-row">
            <span class="file-info-label">File Size:</span>
            <span class="file-info-value" id="fileSize">-</span>
          </div>
          <div class="file-info-row">
            <span class="file-info-label">File Type:</span>
            <span class="file-info-value" id="fileType">-</span>
          </div>
        </div>

        <div class="button-group">
          <button id="cancelBtn" class="btn-cancel">Cancel</button>
          <button id="confirmBtn" class="btn-confirm">Confirm & Upload</button>
        </div>
      </div>

      <!-- Status Message -->
      <div id="statusMsg" style="display:none;"></div>

      <!-- Analysis Result -->
      <div id="analysisResult" class="analysis-result">
        <h3>‚úÖ CV Analysis Complete</h3>
        <div class="analysis-content">
          <ul id="analysisList"></ul>
        </div>
      </div>

      <!-- Navigation Options -->
      <div id="navOptions" class="nav-options">
        <h3>üéâ Success! Where would you like to go next?</h3>
        <p>Your CV has been analyzed. Choose your next step:</p>
        
        <div class="nav-cards">
          <div class="nav-card" onclick="navigateTo('interview')">
            <span class="nav-card-icon">üó£Ô∏è</span>
            <h4>Start Interview</h4>
            <p>Practice with personalized questions based on your CV</p>
          </div>
          
          <div class="nav-card" onclick="navigateTo('code')">
            <span class="nav-card-icon">üíª</span>
            <h4>Code Practice</h4>
            <p>Solve coding challenges tailored to your skills</p>
          </div>
          
          <div class="nav-card" onclick="navigateTo('dashboard')">
            <span class="nav-card-icon">üìä</span>
            <h4>Dashboard</h4>
            <p>View your progress and stats</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <span class="footer-logo">EVALUX</span>
      <p>&copy; 2025 EVALUX. All rights reserved.</p>
    </div>
  </footer>

  <script>
    let selectedFile = null;

    const cvFileInput = document.getElementById('cvFile');
    const browseBtn = document.getElementById('browseBtn');
    const uploadArea = document.getElementById('uploadArea');
    const previewSection = document.getElementById('previewSection');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');
    const statusMsg = document.getElementById('statusMsg');
    const analysisResult = document.getElementById('analysisResult');

    browseBtn.addEventListener('click', function(e) {
      e.preventDefault();
      cvFileInput.click();
    });

    cvFileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      
      if (!file) return;

      const allowedTypes = ['application/pdf', 'application/msword', 
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      const allowedExts = ['.pdf', '.doc', '.docx'];
      
      if (!allowedTypes.includes(file.type) && 
          !allowedExts.some(ext => file.name.toLowerCase().endsWith(ext))) {
        showStatus('Invalid file type. Please upload PDF or Word document.', 'error');
        cvFileInput.value = '';
        return;
      }

      if (file.size > 10 * 1024 * 1024) {
        showStatus('File too large. Maximum size is 10MB.', 'error');
        cvFileInput.value = '';
        return;
      }

      selectedFile = file;
      showPreview(file);
    });

    function showPreview(file) {
      uploadArea.style.display = 'none';
      previewSection.classList.add('active');
      
      document.getElementById('fileName').textContent = file.name;
      document.getElementById('fileSize').textContent = formatFileSize(file.size);
      document.getElementById('fileType').textContent = getFileExtension(file.name).toUpperCase();
      
      statusMsg.style.display = 'none';
      analysisResult.classList.remove('active');
    }

    cancelBtn.addEventListener('click', function() {
      selectedFile = null;
      cvFileInput.value = '';
      
      uploadArea.style.display = 'block';
      previewSection.classList.remove('active');
      
      showStatus('Upload cancelled.', 'info');
    });

    confirmBtn.addEventListener('click', async function() {
      if (!selectedFile) {
        showStatus('No file selected.', 'error');
        return;
      }

      const token = localStorage.getItem('evalux_token');
      
      if (!token) {
        showStatus('Please login before uploading CV.', 'error');
        setTimeout(() => {
          window.location.href = 'profile.html';
        }, 2000);
        return;
      }

      confirmBtn.disabled = true;
      confirmBtn.textContent = 'Uploading...';
      
      showStatus('Uploading and analyzing your CV...', 'info');

      const formData = new FormData();
      formData.append('file', selectedFile);

      try {
        const res = await fetch('http://127.0.0.1:8000/cv/analyze', {
          method: 'POST',
          body: formData,
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const data = await res.json();

        if (res.ok) {
          showStatus('‚úÖ CV analyzed successfully!', 'success');
          localStorage.setItem('cv_analysis_data', JSON.stringify(data));
          displayAnalysis(data);
          previewSection.classList.remove('active');

          setTimeout(() => {
            document.getElementById('navOptions').classList.add('active');
          }, 1000);

        } else {
          showStatus(data.detail || 'Upload failed. Please try again.', 'error');
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Confirm & Upload';
        }

      } catch (err) {
        console.error('Upload error:', err);
        showStatus('Server error during upload. Please try again.', 'error');
        confirmBtn.disabled = false;
        confirmBtn.textContent = 'Confirm & Upload';
      }
    });

    function displayAnalysis(data) {
      const analysisList = document.getElementById('analysisList');
      analysisList.innerHTML = '';

      if (data.skills && data.skills.length > 0) {
        const skillLi = document.createElement('li');
        skillLi.innerHTML = `<strong>Skills detected:</strong> ${data.skills.join(', ')}`;
        analysisList.appendChild(skillLi);
      }

      if (data.interview_questions && data.interview_questions.length > 0) {
        const questLi = document.createElement('li');
        questLi.innerHTML = `<strong>Interview questions prepared:</strong> ${data.interview_questions.length} personalized questions`;
        analysisList.appendChild(questLi);
      }

      analysisResult.classList.add('active');
    }

    function showStatus(message, type) {
      statusMsg.textContent = message;
      statusMsg.className = `status-msg ${type}`;
      statusMsg.style.display = 'block';

      if (type !== 'info') {
        setTimeout(() => {
          statusMsg.style.display = 'none';
        }, 5000);
      }
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    function getFileExtension(filename) {
      return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
    }

    function navigateTo(page) {
      const routes = {
        'interview': 'interview.html?cv_based=true',
        'code': 'code.html',
        'dashboard': 'dashboard.html'
      };
      
      if (routes[page]) {
        window.location.href = routes[page];
      }
    }
  </script>
</body>
</html>